<?php	class Autocomplete extends Controller{			function __construct(){			parent::__construct();			$session_id = $this->UserLogin->isLogin();			$this->user = $session_id['username'];			$this->pt = $session_id['id_pt'];		}				/* AP-INVOICE */		function get_autocomplete_po(){			$term = $this->input->post('term');			/*LEFT JOIN DB_APLEDGER ON DB_APLEDGER.REF_NO=DB_BARANGPOH.BRGPOH_ID					LEFT JOIN DB_APINVOICE ON DB_APINVOICE.REF_NO=DB_BARANGPOH.BRGPOH_ID					"SELECT id_trbgt,form_kode,PEMASOK.nm_supplier,db_trbgtdiv.remark  FROM DB_BARANGPOH					INNER JOIN PEMASOK ON PEMASOK.KD_SUPPLIER=DB_BARANGPOH.KD_SUPP					INNER JOIN KELUSAHA ON KELUSAHA.ID_KELUSAHA=PEMASOK.ID_KELUSAHA					INNER JOIN DB_PR ON DB_PR.no_pr = db_BarangPOH.reff_pr					LEFT JOIN db_trbgtdiv ON db_trbgtdiv.id_trbgt = db_pr.trbgt_id					WHERE form_kode like ('A%') and db_trbgtdiv.id_pt = ".$this->pt."ORDER BY id_trbgt DESC"*/			#$Qry  = "SELECT brgpoh_id,no_po FROM db_barangPOH WHERE isLockMR = 0 and no_po LIKE '".$term."%' ORDER BY no_po DESC";			$Qry  = "SELECT id_trbgt,form_kode,nm_supp as nm_supplier,db_trbgtdiv.remark from db_trbgtdiv 					join db_pr on db_trbgtdiv.id_trbgt = db_pr.trbgt_id 					join db_BarangPOH on db_pr.no_pr = db_BarangPOH.reff_pr where form_kode like ('%$term%') and db_trbgtdiv.id_pt = '".$this->pt."' ORDER BY id_trbgt DESC";			#$Qry  = "select id_trbgt,form_kode from db_trbgtdiv where flag_pr = 1 and form_kode like ('A%') and id_pt = ".$this->pt."ORDER BY id_trbgt DESC";			$Sql  = $this->db->query($Qry)->result();			#var_dump($sql);			$hu = $this->db->query($Qry)->num_rows();						if($hu == 0){								$row_set[] = "Tidak Ada PO"; 				echo json_encode($row_set);			}else{									foreach ($Sql as $r){				$r->value  = $r->form_kode." | ".$r->nm_supplier." | ".$r->remark;				$r->id	   = $r->id_trbgt;				$row_set[] = $r; 					}			echo json_encode($row_set); 		}		}						function get_autocomplete_cjc(){			$term = $this->input->post('term');			$Qry  = "SELECT id_cjc,no_cjc FROM db_cjc WHERE flag_id = 1 and no_cjc LIKE '".$term."%' ORDER BY no_cjc ASC";			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->no_cjc;				$r->id	   = $r->id_cjc;				$row_set[] = $r; 					}			echo json_encode($row_set); 		}				function get_autocomplete_pro(){			$term = $this->input->post('term');			$Qry  = "SELECT mainjob_id,no_trbgtproj FROM db_mainjob WHERE no_trbgtproj LIKE '".$term."%' ORDER BY mainjob_id ASC";			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->no_trbgtproj;				$r->id	   = $r->mainjob_id;				$row_set[] = $r; 					}			echo json_encode($row_set); 		}						function get_autocomplete_ope(){			$session_id = $this->UserLogin->isLogin();			$this->user = $session_id['username'];			$this->pt	= $session_id['id_pt'];			//die($this->pt);			$term = $this->input->post('term');			#$Qry  = "select * from db_trbgtdiv where id_pt = ".$this->pt." and LEFT(form_kode,1) = 'A' and SUBSTRING(form_kode,14,5) like ('%".$term."%')";			$Qry  = "select top(10) form_kode,code_id,remark,id_trbgt from db_trbgtdiv a			left join db_apinvoice b on a.id_trbgt = b.ref_no			where (b.status is null) and ((a.id_pt = '".$this->pt."' and a.form_kode like 'A%' 			and a.form_kode like '%$term%')			or (a.id_pt = '".$this->pt."' and a.form_kode like 'A%' and a.remark like '%$term%') or (a.id_pt = '".$this->pt."' and a.form_kode like 'A%' and a.code_id like '%$term%')) order by a.id_trbgt desc";			//$Qry  = "select top(10) form_kode,code_id,remark,id_trbgt from db_trbgtdiv where id_pt = ".$this->pt." and (LEFT(form_kode,1) = 'A' and SUBSTRING(form_kode,14,5) like ('%".$term."%')) or remark like ('%".$term."%') or code_id like '%$term%' order by id_trbgt desc";			$Sql  = $this->db->query($Qry)->result();			$cek = $this->db->query($Qry)->num_rows();			if($cek == 0){				$row_set[] = "Tidak Ada Budget";			}else{			foreach ($Sql as $r){				$r->value  = $r->form_kode." | ".$r->code_id." | ".$r->remark;				$r->id	   = $r->id_trbgt;				$row_set[] = $r; 					}			}			echo json_encode($row_set); 					}				/* AP-CREDITNOTE */		function get_autocomplete_apcn(){			$term = $this->input->post('term');			$Qry  = "SELECT top(7) kd_supplier,nm_supp_gb FROM pemasok WHERE nm_supp_gb LIKE '".$term."%' ORDER BY nm_supp_gb";			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->nm_supp_gb;				$r->id	   = $r->kd_supplier;				$row_set[] = $r; 					}			echo json_encode($row_set); 		}				function get_autocomplete_coaacno_gl(){			$term = $this->input->post('term');			$Qry  = "SELECT acc_no,acc_name FROM db_coa WHERE acc_no LIKE '".$term."%' or acc_name LIKE '".$term."%' and type='2.00' ORDER BY id_coa";			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->acc_no." | ".$r->acc_name;				$r->id	   = $r->acc_name;				$row_set[] = $r; 					}			echo json_encode($row_set);		}				function get_autocomplete_coaacno(){			$term = $this->input->post('term');			$Qry  = "SELECT acc_no,acc_name FROM db_coa WHERE acc_no LIKE '".$term."%' or acc_name LIKE '".$term."%' and id_pt = ".$this->pt." ORDER BY id_coa";			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->acc_no." | ".$r->acc_name;				$r->id	   = $r->acc_name;				$row_set[] = $r; 					}			echo json_encode($row_set);		}				function get_autocomplete_coaacname(){			$term = $this->input->post('term');			$Qry  = "SELECT acc_no,acc_name FROM db_coa WHERE acc_name LIKE '".$term."%' and id_pt = ".$this->pt." ORDER BY acc_name";			$Sql  = $this->db->query($Qry)->result();			#var_dump($Sql);exit();			foreach ($Sql as $r){				$r->value  = $r->acc_name;				$r->id	   = $r->acc_no;				$row_set[] = $r; 					}			echo json_encode($row_set);		}				function get_autocomplete_jcoa(){			$term = $this->input->post('term');			$Qry  = "SELECT acc_no,acc_name FROM db_coa WHERE acc_no LIKE '".$term."%' or acc_name LIKE '".$term."%' and id_pt='".$this->pt."'  ORDER BY id_coa";			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->acc_no." | ".$r->acc_name;				$r->id	   = $r->acc_no;				$row_set[] = $r; 					}			echo json_encode($row_set);		}				/* Customer */		function get_autocomplete_cus(){			$session_id = $this->UserLogin->isLogin();			$this->user = $session_id['username'];			$this->pt	= $session_id['id_pt'];			$idp  = $this->input->post('idprojek');			$term = $this->input->post('term');			#$Qry  = "select * from db_trbgtdiv where id_pt = ".$this->pt." and LEFT(form_kode,1) = 'A' and SUBSTRING(form_kode,14,5) like ('%".$term."%')";			#$Qry  = "select top(10) customer_id, customer_nama from db_customer where id_pt = ".$this->pt." and customer_nama like ('%".$term."%')";			$Qry   = "select id_customer,customer_nama,id_unit,nm_subproject from						db_customer join db_sp on db_customer.customer_id = db_sp.id_customer									join db_subproject on db_sp.id_subproject = db_subproject.subproject_id					where db_subproject.subproject_id = ".$idp." and customer_nama like ('%".$term."%') order by customer_nama asc"; 			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->customer_nama;				$r->id	   = $r->id_customer;				$row_set[] = $r; 					}			echo json_encode($row_set);		}		function get_coa(){			$session_id = $this->UserLogin->isLogin();			$this->pt	= $session_id['id_pt'];			$term = $this->input->post('term');			$Qry  = "SELECT acc_no,acc_name FROM db_coa WHERE acc_no LIKE '".$term."%' or acc_name LIKE '".$term."%' and id_pt = ".$this->pt." ORDER BY id_coa";			$Sql  = $this->db->query($Qry)->result();						if (count($Sql) > 0) {				foreach ($Sql as $r){					$r->value  = $r->acc_no;					$r->id	   = $r->acc_name;					$row_set[] = $r; 						}			} else {				$r->value  = "Tidak Ada COA";				$r->id	   = "Tidak Ada COA";				$row_set[] = $r; 			}			echo json_encode($row_set);		}				/* AP-PAYMENT CUSTOMER */		function get_appayment(){ 			$term = $this->input->post('term');			$Qry  = "select * from db_apinvoice where doc_no like '".$term."%'";			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->doc_no;				$r->id	   = $r->apinvoice_id;				$row_set[] = $r; 					}			echo json_encode($row_set);				}				/* PO JURNAL SINGLE*/		function get_autocomplete_accdr(){			$term = $this->input->post('term');			$Qry  = "SELECT top(10) acc_no,acc_name FROM db_coa WHERE acc_no LIKE '".$term."%' or acc_name LIKE '".$term."%' and id_pt='".$this->pt."' ORDER BY id_coa";			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->acc_no." | ".$r->acc_name;				$r->id	   = $r->acc_name;				$row_set[] = $r; 					}			echo json_encode($row_set);		}				/* PO JURNAL MULTI*/		function get_autocomplete_mjcoa(){			$term = $this->input->post('term');			$Qry  = "SELECT top(10) acc_no,acc_name FROM db_coa WHERE acc_no LIKE '".$term."%' or acc_name LIKE '".$term."%' and id_pt='".$this->pt."' ORDER BY id_coa";			$Sql  = $this->db->query($Qry)->result();						foreach ($Sql as $r){				$r->value  = $r->acc_no." | ".$r->acc_name;				$r->id	   = $r->acc_name;				$row_set[] = $r; 					}			echo json_encode($row_set);		}				/* GL Module (adjusment jurnal)*/		/* sG */		function get_autocomplete_subledger(){			$term = $this->input->post('term');			$Qry = "select nm_supplier,kd_supp_gb from pemasok where nm_supplier like '".$term."%'";			$Sql  = $this->db->query($Qry)->result();			foreach ($Sql as $r){				$r->value  = $r->nm_supplier;				$r->id	   = $r->kd_supp_gb;				$row_set[] = $r; 					}			echo json_encode($row_set);		}				function get_apno($c){			$tmp = '';			if($c){				$Q = "select apinvoice_id, doc_no from db_apinvoice where vendor_acct = ".$c."";				$data = $this->db->query($Q)->result_array();			}else{				$tmp .= "<option>Pilih No AP</option>";				die($tmp);			}						if (!empty($data)) {				$tmp .= "<option>Pilih No AP</option>";				foreach ($data as $row) {					$tmp .= "<option value='" . $row['apinvoice_id'] . "'>" . $row['doc_no'] . "</option>";				}			} else {				$tmp .= "<option>Pilih No AP</option>";			}			die($tmp);		}				function get_baseamt(){			$c = $this->input->post('c');			$Q = $this->db->query("select base_amt from db_apinvoice where apinvoice_id = ".$c."")->result();			echo $Q[0]->base_amt;		}				function gettemp_apno(){			$c = $this->input->post('c');			$Q = $this->db->query("select doc_no from db_apinvoice where apinvoice_id = ".$c."")->result();			echo $Q[0]->doc_no;		}		/* eG */		function get_autocomplete_vendor(){			$term = $this->input->post('term');			$Qry  = "SELECT kd_supp_gb,nm_supplier FROM pemasokMaster WHERE nm_supplier LIKE '".$term."%' ORDER BY nm_supplier";			$Sql  = $this->db->query($Qry)->result();						if (count($Sql) > 0) {				foreach ($Sql as $r){					$r->value  = $r->nm_supplier;					$r->id	   = $r->kd_supp_gb;					$row_set[] = $r; 						}			} else {				$r->value  = "Tidak Ada COA";				$r->id	   = "Tidak Ada COA";				$row_set[] = $r; 			}			echo json_encode($row_set);					}	}